---
title: "Tet2 Ripk3 RNA Sequencing Work"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Initial Setup:

Load required packages and set working directory.

```{r packages}
library(DESeq2)
library(tximport)
library(tidyverse)
library(rnaseqGene)
library(pheatmap)
library(ggalt)
library(cowplot)
```

# DESeq2 analysis
Load data into DESeq dataset

```{r load data}
cts2 <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/raw_counts modified corrected triplicates.csv") #file path to Counts csv document
cts2 <- cts2[, -1] #only necessary if bulk seq data has ensembl id before gene names
cts <- cts2[, -1]
table(duplicated(cts$Gene.name)) #check for duplicate gene names
rownames(cts) <- make.names(cts2$Gene.name, unique = TRUE) #forces gene names to become unique
rm(cts2)
cd <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/coldata.csv") #make coldata file with sample names in one column and then condition in second column
dds <- DESeqDataSetFromMatrix(countData = cts, colData = cd, design = ~ condition)
```

Differential Expression

```{r DESeq}
dds <- DESeq(dds)
rescmp <- results(dds) 
vst <- vst(dds, blind=FALSE)
rlog <- rlog(dds, blind=FALSE)
```

write results as csv

```{r save results}
write.csv(rescmp, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/completeresults.csv")
```

### Comparison 1 of 3: DKO-WT

```{r}
res1 <- DESeq2::results(dds, 
                       contrast = c("condition", "DKO", "WT"),
                       independentFiltering = TRUE,
)
write.csv(res1, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/dko_wt.csv")
```

### Comparison 2 of 3: Tet2KO-WT

```{r}
res2 <- DESeq2::results(dds, 
                       contrast = c("condition", "Tet2KO", "WT"),
                       independentFiltering = TRUE,
)
write.csv(res2, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/tet2_wt.csv")
```

### Comparison 3 of 3: DKO-Tet2KO

```{r}
res3 <- DESeq2::results(dds, 
                       contrast = c("condition", "DKO", "Tet2KO"),
                       independentFiltering = TRUE,
)
write.csv(res3, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/dko_tet2ko.csv")
```

#### Filter for p-value

```{r filter for p-value}
res_filtered1 <- res1[which(res1$padj < 0.1 & !is.na(res1$padj)), ]

write.csv(res_filtered1, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/dko_wt_filter.csv")

res_filtered2 <- res2[which(res2$padj < 0.1 & !is.na(res1$padj)), ]

write.csv(res_filtered2, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/tet2_wt_filter.csv")

res_filtered3 <- res3[which(res3$padj < 0.1 & !is.na(res1$padj)), ]

write.csv(res_filtered3, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/dko_tet2ko_filter.csv")
```

## Generate Heatmap

```{r top 20 heatmap}
select <- order(rowMeans(abs(assay(rlog))),
                decreasing=TRUE)[1:50]
df <- as.data.frame(colData(rlog)[,c("condition")])
color_palette <- colorRampPalette(c("blue", "white", "red"))(100)
pheatmap(assay(rlog)[select,], cluster_rows=FALSE, show_rownames=TRUE,
         cluster_cols=FALSE, color=color_palette, main="Top 20 Heatmap")
```

Attempt at top 20 from each condition heatmap
```{r Top 20 from each condition heatmap (WIP)}

# Assuming you have a DESeqDataSet object called 'dds'
# Perform differential expression analysis for each condition

# Rank genes based on adjusted p-value
top_genes_condition1 <- head(order(res_filtered1$log2FoldChange), 20)
top_genes_condition2 <- head(order(res_filtered2$log2FoldChange), 20)
top_genes_condition3 <- head(order(res_filtered3$log2FoldChange), 20)

# Extract top 20 genes for each condition
top_genes_condition1 <- rownames(res_filtered1)[top_genes_condition1]
top_genes_condition2 <- rownames(res_filtered2)[top_genes_condition2]
top_genes_condition3 <- rownames(res_filtered3)[top_genes_condition3]

# Combine results
top_genes <- unique(c(top_genes_condition1, top_genes_condition2, top_genes_condition3))

# Subset normalized counts to include only the genes of interest
subset_rlog <- assay(rlog)[rownames(rlog) %in% top_genes, ]
subset_rlog <- as.matrix(subset_rlog)

# Define the desired column order
desired_order <- c("WT_1", "WT_2", "WT_3", "Tet2KO_1", "Tet2KO_2", "Tet2KO_3", "DKO_1", "DKO_2", "DKO_3")

# Reorder the columns
subset_rlog <- subset_rlog[, desired_order]

# Extract column data (sample information) and reorder it
col_data <- colData(dds)[desired_order, ]

# Define color palette
color_palette <- colorRampPalette(c("blue", "white", "red"))(100)

# Create a heatmap
heatmap <- pheatmap(subset_rlog, 
         scale = "row", 
         clustering_distance_rows = "euclidean", 
         cluster_cols = FALSE, 
         clustering_method = "complete", 
         color = color_palette,
         show_rownames = TRUE, 
         show_colnames = TRUE,
         main = "Heatmap of AITL Genes",
         treeheight_row = 0)
```
row_order <- order(rowMeans(subset_rlog), decreasing = TRUE)
subset_rlog <- subset_rlog[row_order, ]


```{r Heatmap of Specific Genes}
# List of specific genes
genes_of_interest <- c("Rgs1", "Sh2d1a", "Crip1", "S100a13", "Gabbr1", "Dtnb", "Rsad2", "Cxcl9", 
                       "Kenj10", "Gstm5", "C1qb", "Slc40a1", "Slc43a1", "C1qc", "Veam1", "Marchf1", 
                       "Pla2g2d", "C1qa", "Slc25a37", "Ckap4", "Rgl1", "Mafb", "Pou2af1", "Ighm", 
                       "Il18", "Slco2b1", "Marcks", "Itga9", "Tns3", "Abcc3", "Wdfy3", "Arhgap23")

# Subset normalized counts to include only the genes of interest
subset_rlog <- assay(rlog)[rownames(rlog) %in% genes_of_interest, ]
row_order <- order(rowMeans(subset_rlog), decreasing = TRUE)
subset_rlog <- subset_rlog[row_order, ]
subset_rlog <- as.matrix(subset_rlog)

# Define the desired column order
desired_order <- c("WT_1", "WT_2", "WT_3", "Tet2KO_1", "Tet2KO_2", "Tet2KO_3", "DKO_1", "DKO_2", "DKO_3")

# Reorder the columns
subset_rlog <- subset_rlog[, desired_order]

# Extract column data (sample information) and reorder it
col_data <- colData(dds)[desired_order, ]

# Define color palette
color_palette <- colorRampPalette(c("blue", "white", "red"))(100)

# Create a heatmap
heatmap <- pheatmap(subset_rlog, 
         scale = "row", 
         clustering_distance_rows = "euclidean", 
         cluster_cols = FALSE, 
         clustering_method = "complete", 
         color = color_palette,
         show_rownames = TRUE, 
         show_colnames = TRUE,
         main = "Heatmap of AITL Genes",
         treeheight_row = 0)
```

##Generate PCA Plot

```{r pca plot}
pca <- plotPCA(rlog)
pca + geom_point(size=5) + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), # White background
    axis.text = element_blank(), # Remove axis numbers
    axis.ticks = element_blank(), # Remove axis ticks
  ) + 
  scale_color_manual(labels=c("Tet2-/- Ripk3-/-", "Tet2-/-", "WT"), values = c("red","blue", "black")) + 
  lims(x=c(-15, 25), y=c(-15, 25))
```

##Display GSEA Results

```{r hallmark pathways}
ht <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/dkoenriched_mh.csv")
ht <- ht[which(ht["FDR.q.val"]<0.2 & abs(ht["NES"])>1),]
htplot <- ggplot(ht, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
htplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.5,2.5)) + 
  labs(x="-log(FDR q-value)", y="Hallmark Pathways", title="DKO vs Tet2KO")

dw1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mhdkowt.Gsea.1727301525643/gsea_report_for_DKO_1727301525643.tsv")
dw2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mhdkowt.Gsea.1727301525643/gsea_report_for_WT_1727301525643.tsv")
hw <- dw1
rm(dw1, dw2)
hw <- hw[which(hw["FDR q-val"]<0.2 & abs(hw["NES"])>1),]
hw <- rename(hw, FDR.q.val="FDR q-val")

dr1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mhdkorest.Gsea.1727301535227/gsea_report_for_DKO_1727301535227.tsv")
dr2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mhdkorest.Gsea.1727301535227/gsea_report_for_REST_1727301535227.tsv")
hr <- dr1
rm(dr1, dr2)
hr <- hr[which(hr["FDR q-val"]<0.2 & abs(hr["NES"])>1),]
hr <- rename(hr, FDR.q.val="FDR q-val")

hwplot <- ggplot(hw, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hwplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.5,2.5)) + 
  labs(x="-log(FDR q-value)", y="Hallmark Pathways", title="DKO vs WT")

hrplot <- ggplot(hr, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hrplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.5,2.5)) + 
  labs(x="-log(FDR q-value)", y="Hallmark Pathways", title="DKO vs rest")

```

```{r}
hwplot <- ggplot(hw, aes(x=-log10(FDR.q.val), y=reorder(NAME, (-log10(FDR.q.val)+NES)), fill = NES))
hwplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.5,2.5)) + 
  labs(x="-log(FDR q-value)", y="Hallmark Pathways", title="DKO vs WT")
```


```{r Selected Pathways}
sel <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/dkotet2selected.csv")
gseaplot <- ggplot(sel, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
gseaplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.5,2.5)) + 
  labs(x="-log(FDR q-value)", y="Selected Pathways", title="Normalized Enrichment Score")
```


```{r reactome pathways}
rdt <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/reactomedkotet2.csv")
rdt <- rdt[which(rdt["FDR.q.val"]<0.2 & abs(rdt["NES"])>1),]

gseaplot <- ggplot(rdt, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
gseaplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.8, 1.8)) + 
  labs(x="-log(FDR q-value)", y="Reactome Pathways", title="DKO vs Tet2KO")

dw1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/reactomedkowt.Gsea.1727282754824/gsea_report_for_DKO_1727282754824.tsv")
dw2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/reactomedkowt.Gsea.1727282754824/gsea_report_for_WT_1727282754824.tsv")
hw <- bind_rows(dw1, dw2)
rm(dw1, dw2)
hw <- hw[which(hw["FDR q-val"]<0.2 & abs(hw["NES"])>1),]
hw <- rename(hw, FDR.q.val="FDR q-val")

dr1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/reactomedkorest.Gsea.1727282772001/gsea_report_for_DKO_1727282772001.tsv")
dr2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/reactomedkorest.Gsea.1727282772001/gsea_report_for_REST_1727282772001.tsv")
hr <- bind_rows(dr1, dr2)
rm(dr1, dr2)
hr <- hr[which(hr["FDR q-val"]<0.2 & abs(hr["NES"])>1),]
hr <- rename(hr, FDR.q.val="FDR q-val")

hwplot <- ggplot(hw, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hwplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.8, 1.8)) + 
  labs(x="-log(FDR q-value)", y="Reactome Pathways", title="DKO vs WT")

hrplot <- ggplot(hr, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hrplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.8, 1.8)) + 
  labs(x="-log(FDR q-value)", y="Reactome Pathways", title="DKO vs rest")

```

```{r cgp}
dt1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/cgpdkotet2.Gsea.1727301555695/gsea_report_for_DKO_1727301555695.tsv")
dt2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/cgpdkotet2.Gsea.1727301555695/gsea_report_for_Tet2KO_1727301555695.tsv")
ht <- bind_rows(dt1, dt2)
rm(dt1, dt2)
ht <- ht[which(ht["FDR q-val"]<0.2 & abs(ht["NES"])>1),]
ht <- rename(ht, FDR.q.val="FDR q-val")

dw1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/cgpdkowt.Gsea.1727301571556/gsea_report_for_DKO_1727301571556.tsv")
dw2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/cgpdkowt.Gsea.1727301571556/gsea_report_for_WT_1727301571556.tsv")
hw <- bind_rows(dw1, dw2)
rm(dw1, dw2)
hw <- hw[which(hw["FDR q-val"]<0.125 & abs(hw["NES"])>1),]
hw <- rename(hw, FDR.q.val="FDR q-val")

dr1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/cgpdkorest.Gsea.1727301646239/gsea_report_for_DKO_1727301646239.tsv")
dr2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/cgpdkorest.Gsea.1727301646239/gsea_report_for_REST_1727301646239.tsv")
hr <- bind_rows(dr1, dr2)
rm(dr1, dr2)
hr <- hr[which(hr["FDR q-val"]<0.125 & abs(hr["NES"])>1),]
hr <- rename(hr, FDR.q.val="FDR q-val")

htplot <- ggplot(ht, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
htplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.9,1.9)) + 
  labs(x="-log(FDR q-value)", y="CGP Pathways", title="DKO vs Tet2KO")

hwplot <- ggplot(hw, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hwplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.9,1.9)) + 
  labs(x="-log(FDR q-value)", y="CGP Pathways", title="DKO vs WT")

hrplot <- ggplot(hr, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hrplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.9,1.9)) + 
  labs(x="-log(FDR q-value)", y="CGP Pathways", title="DKO vs rest")
```

```{r gobp}
dt1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/gobpdkotet2.Gsea.1727282860346/gsea_report_for_DKO_1727282860346.tsv")
dt2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/gobpdkotet2.Gsea.1727282860346/gsea_report_for_Tet2KO_1727282860346.tsv")
ht <- bind_rows(dt1, dt2)
rm(dt1, dt2)
ht <- ht[which(ht["FDR q-val"]<0.2 & abs(ht["NES"])>1),]
ht <- rename(ht, FDR.q.val="FDR q-val")

dw1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/gobpdkowt.Gsea.1727291254438/gsea_report_for_DKO_1727291254438.tsv")
dw2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/gobpdkowt.Gsea.1727291254438/gsea_report_for_WT_1727291254438.tsv")
hw <- bind_rows(dw1, dw2)
rm(dw1, dw2)
hw <- hw[which(hw["FDR q-val"]<0.141 & abs(hw["NES"])>1),]
hw <- rename(hw, FDR.q.val="FDR q-val")

dr1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/gobpdkorest.Gsea.1727291264237/gsea_report_for_DKO_1727291264237.tsv")
dr2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/gobpdkorest.Gsea.1727291264237/gsea_report_for_REST_1727291264237.tsv")
hr <- bind_rows(dr1, dr2)
rm(dr1, dr2)
hr <- hr[which(hr["FDR q-val"]<0.12 & abs(hr["NES"])>1),]
hr <- rename(hr, FDR.q.val="FDR q-val")

htplot <- ggplot(ht, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
htplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.9,1.9)) + 
  labs(x="-log(FDR q-value)", y="GOBP", title="DKO vs Tet2KO")

hwplot <- ggplot(hw, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hwplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.9,1.9)) + 
  labs(x="-log(FDR q-value)", y="GOBP", title="DKO vs WT")

hrplot <- ggplot(hr, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hrplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.9,1.9)) + 
  labs(x="-log(FDR q-value)", y="GOBP", title="DKO vs rest")
```


```{r mpt}
dt1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mptdkotet2.Gsea.1727291543940/gsea_report_for_DKO_1727291543940.tsv")
dt2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mptdkotet2.Gsea.1727291543940/gsea_report_for_Tet2KO_1727291543940.tsv")
mt <- bind_rows(dt1, dt2)
rm(dt1, dt2)
mt <- mt[which(mt["FDR q-val"]<0.2 & abs(mt["NES"])>1),]
mt <- rename(mt, FDR.q.val="FDR q-val")

mw <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mptdkowt.Gsea.1727294678841/gsea_report_for_DKO_1727294678841.tsv")
mw <- mw[which(mw["FDR q-val"]<0.2 & abs(mw["NES"])>1),]
mw <- rename(mw, FDR.q.val="FDR q-val")

dr1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mptdkorest.Gsea.1727294693964/gsea_report_for_DKO_1727294693964.tsv")
dr2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240925/mptdkorest.Gsea.1727294693964/gsea_report_for_REST_1727294693964.tsv")
mr <- bind_rows(dr1, dr2)
mr <- mr[which(mr["FDR q-val"]<0.2 & abs(mr["NES"])>1),]
mr <- rename(mr, FDR.q.val="FDR q-val")
rm(dr1, dr2)

mtplot <- ggplot(mt, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
mtplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.6, 1.6)) + 
  labs(x="-log(FDR q-value)", y="MPT Pathways", title="DKO vs Tet2KO")

mwplot <- ggplot(mw, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
mwplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.6, 1.6)) + 
  labs(x="-log(FDR q-value)", y="MPT Pathways", title="DKO vs WT")

mrplot <- ggplot(mr, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
mrplot + geom_point(size=5, shape=21) + 
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") + 
  theme(
    panel.background = element_rect(fill = "white", color = "black"), 
    plot.title = element_text(hjust = 0.5)
    ) + 
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-1.6, 1.6)) + 
  labs(x="-log(FDR q-value)", y="MPT Pathways", title="DKO vs rest")
```

```{r GSEA Results}
dt1 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/total.Gsea.1727713030884/gsea_report_for_DKO_1727713030884.tsv")
dt2 <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/total.Gsea.1727713030884/gsea_report_for_Tet2KO_1727713030884.tsv")
ht <- bind_rows(dt1, dt2)
rm(dt1, dt2)
ht <- ht[which(ht["FDR q-val"]<0.25 & abs(ht["NES"])>1),]
ht <- rename(ht, FDR.q.val="FDR q-val")

write.csv(ht, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/filtereddkotet2.csv")

hw <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/totalwt.Gsea.1727713054043/gsea_report_for_DKO_1727713054043.tsv")
hw <- hw[which(hw["FDR q-val"]<0.25 & abs(hw["NES"])>1),]
hw <- rename(hw, FDR.q.val="FDR q-val")

write.csv(hw, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/filtereddkowt.csv")

hr <- read_tsv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/totaltet2wt.Gsea.1727713885757/gsea_report_for_Tet2KO_1727713885757.tsv")
hr <- hr[which(hr["FDR q-val"]<0.25 & abs(hr["NES"])>1),]
hr <- rename(hr, FDR.q.val="FDR q-val")

write.csv(hr, "C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/filteredtet2wt.csv")
```

```{r Generate Plots}
ht <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/total.Gsea.1727713030884/finaltfoll.csv")
htplot <- ggplot(ht, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
htplot + geom_point(size=5, shape=21) + 
 theme(
    panel.background = element_rect(fill = "white"), 
    panel.border = element_rect(color = "black", fill = NA), 
    plot.title = element_text(hjust = 0.5), 
    axis.text=element_text(color="black", face="bold")
    ) +
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.4,2.4)) + 
  labs(x="-log(FDR q-value)", y="Genesets", title="T cell & Lymphoma Genesets")

hw <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/total.Gsea.1727713030884/finalcellcycle.csv")
hwplot <- ggplot(hw, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hwplot + geom_point(size=5, shape=21) + 
 theme(
    panel.background = element_rect(fill = "white"), 
    panel.border = element_rect(color = "black", fill = NA), 
    plot.title = element_text(hjust = 0.5), 
    axis.text=element_text(color="black", face="bold")
    ) +
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.2,2.2)) + 
  labs(x="-log(FDR q-value)", y="Genesets", title="Cell Cycle & Proliferation Genesets")

hr <- read.csv("C:/Users/rthalla/OneDrive - Loyola University Chicago/Zhang Lab/Kanak Tet2 Ripk3/output/20240930/total.Gsea.1727713030884/finalmyeloid.csv")
hrplot <- ggplot(hr, aes(x=-log10(FDR.q.val), y=reorder(NAME, -log10(FDR.q.val)), fill = NES))
hrplot + geom_point(size=5, shape=21) + 
 theme(
    panel.background = element_rect(fill = "white"), 
    panel.border = element_rect(color = "black", fill = NA), 
    plot.title = element_text(hjust = 0.5), 
    axis.text=element_text(color="black", face="bold")
    ) +
  scale_fill_gradient2(low="blue", mid="white", high="red", midpoint=0, limits=c(-2.0,2.0)) + 
  labs(x="-log(FDR q-value)", y="Genesets", title="Myeloid Genesets")
```

